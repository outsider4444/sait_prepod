{% extends 'base.html' %}
{% load poll_extras %}

{% block content %}

    <a href="{% url 'admin-trpo_students_marks_create' %}"> Создать новую оценку</a>

    <div id="div-select-ajax">
        <select name="" id="id_group_select" data-group-url="{% url 'trpo-ajax' %}">
        <option value="0">----------</option>
        <option value="1">231</option>
        <option value="2">232</option>
        <option value="3">331</option>
        <option value="4">332</option>
    </select></div>


    <input id="btn-search" type="button" value="Поиск по дате">

    <div id="calendar-search">
        <form action="{% url 'admin-trpo-filtred_students_marks' %}" method="get">
            {% csrf_token %}
            {{ mark_filter.form }}
            <button type="submit">Поиск</button>
        </form>
    </div>

    <table border="1px" id="id_students_list" class="table table-responsive">
        <thead class="thead-dark">
        <tr>
            <th>#</th>
            {% for date in delta_date %}
                <th>{{ date }}</th>
            {% endfor %}
        </tr>
        </thead>
         <tbody>
        {% for stud in marks|values:"users_code"|distinct %}
                <tr>
                    <td>{{ stud.name }} {{ stud.surname }}</td>
                    {% for days in delta_days %}
                        <td>
                            {% for marks_date in marks %}
                                {% if marks_date.date|string == days %}
                                    {{ marks_date.mark }}
                                {% endif %}
                            {% endfor %}
                        </td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

    <script>
        $("#id_group_select").change(function () {
            const url = $("#id_group_select").attr("data-group-url");
            const id_group = $('#id_group_select option:selected').text();
            console.log(id_group)

            $.ajax({
                url: url,
                data: {
                    'id_group': id_group,
                },
                success: function (data) {
                    $("#id_students_list").html(data);

                }
            });

        });
    </script>
    <script>
    let id_calendar_search = document.getElementById('calendar-search');id_calendar_search.hidden = true;
    $("#btn-search").click(function (){
        if (document.getElementById('btn-search').value == 'Поиск по дате'){
            id_calendar_search.hidden = false;
            document.getElementById('div-select-ajax').hidden = true;
            document.getElementById('btn-search').value == 'Фильтрация по группам'
        } else {
            id_calendar_search.hidden = true;
            document.getElementById('div-select-ajax').hidden = false;
            document.getElementById('btn-search').value == 'Поиск по дате'
        }

    })

    </script>
{% endblock %}